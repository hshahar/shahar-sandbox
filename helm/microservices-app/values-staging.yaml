# Staging Environment Values

environment: staging
namespace: sha-staging

# Vault integration - Enabled for staging
vault:
  enabled: true
  refreshInterval: "30m"

# Argo Rollouts - Enabled for canary deployments
argoRollouts:
  enabled: true
  canary:
    pauseDuration:
      step1: "3m"   # Longer pause for staging validation
      step2: "5m"
      step3: "10m"
  analysis:
    successRate:
      threshold: 97
      count: 8
      failureLimit: 2
    latency:
      threshold: 300
      count: 8
      failureLimit: 2
    resources:
      cpuThreshold: 75
      memoryThreshold: 80
      count: 6
      failureLimit: 1
    uptime:
      threshold: 99
      count: 6
      failureLimit: 1

# Monitoring - Enabled with stricter thresholds
monitoring:
  enabled: true
  alerts:
    errorRate:
      threshold: 3
    latencyP95:
      threshold: 500

# Frontend configuration
frontend:
  enabled: true
  replicas: 2
  image:
    repository: nginx
    tag: "1.25-alpine"
    pullPolicy: IfNotPresent
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi

# Backend configuration
backend:
  enabled: true
  replicas: 2
  image:
    repository: hashicorp/http-echo
    tag: "latest"
    pullPolicy: IfNotPresent
  service:
    port: 8080
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
  database: sha_blog_staging
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  persistence:
    size: 5Gi

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  host: sha-staging.blog.local
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    # Connection draining for graceful shutdown
    nginx.ingress.kubernetes.io/proxy-send-timeout: "120"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "120"
    nginx.ingress.kubernetes.io/upstream-keepalive-timeout: "120"
  tls:
    enabled: false

# Secrets - Use stronger passwords in staging
secrets:
  database:
    username: "staginguser"
    password: "staging-secure-pass-456"
  backend:
    apiKey: "staging-api-key-67890"

# Security Configuration
security:
  userNamespaces:
    enabled: true  # Enable if supported
  kyverno:
    enabled: true
    validationFailureAction: audit  # Warn but don't block

# Network Policy
networkPolicy:
  enabled: true
  allowExternalEgress: true
